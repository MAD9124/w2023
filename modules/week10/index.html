<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Week 10: Object Data Modelling with Mongoose | MAD9124</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Full-stack: API Development">
    
    <link rel="preload" href="/w2023/assets/css/0.styles.9d277d19.css" as="style"><link rel="preload" href="/w2023/assets/js/app.a268f35f.js" as="script"><link rel="preload" href="/w2023/assets/js/3.30d56026.js" as="script"><link rel="preload" href="/w2023/assets/js/5.9d721531.js" as="script"><link rel="preload" href="/w2023/assets/js/16.1e8637e4.js" as="script"><link rel="prefetch" href="/w2023/assets/js/10.b7c1a16d.js"><link rel="prefetch" href="/w2023/assets/js/11.f2aecf7a.js"><link rel="prefetch" href="/w2023/assets/js/12.7642e84c.js"><link rel="prefetch" href="/w2023/assets/js/13.5e27a08c.js"><link rel="prefetch" href="/w2023/assets/js/14.4b92b91c.js"><link rel="prefetch" href="/w2023/assets/js/15.628eb87b.js"><link rel="prefetch" href="/w2023/assets/js/17.feedfd9c.js"><link rel="prefetch" href="/w2023/assets/js/18.4d23c18f.js"><link rel="prefetch" href="/w2023/assets/js/19.bdc3f6f0.js"><link rel="prefetch" href="/w2023/assets/js/2.c49fd8f9.js"><link rel="prefetch" href="/w2023/assets/js/20.7bb0ba89.js"><link rel="prefetch" href="/w2023/assets/js/21.bbf158ab.js"><link rel="prefetch" href="/w2023/assets/js/22.04ba04d6.js"><link rel="prefetch" href="/w2023/assets/js/23.b3f8222f.js"><link rel="prefetch" href="/w2023/assets/js/24.74d3f93b.js"><link rel="prefetch" href="/w2023/assets/js/25.5343cc2e.js"><link rel="prefetch" href="/w2023/assets/js/26.9f73a8bf.js"><link rel="prefetch" href="/w2023/assets/js/27.45bceba5.js"><link rel="prefetch" href="/w2023/assets/js/28.3f49100e.js"><link rel="prefetch" href="/w2023/assets/js/29.dff6b604.js"><link rel="prefetch" href="/w2023/assets/js/30.0d01a8e4.js"><link rel="prefetch" href="/w2023/assets/js/31.cfbc8e9f.js"><link rel="prefetch" href="/w2023/assets/js/32.2bd8381f.js"><link rel="prefetch" href="/w2023/assets/js/33.c0fa7e80.js"><link rel="prefetch" href="/w2023/assets/js/34.a29cefed.js"><link rel="prefetch" href="/w2023/assets/js/35.26354f67.js"><link rel="prefetch" href="/w2023/assets/js/36.5d697666.js"><link rel="prefetch" href="/w2023/assets/js/37.19db9f95.js"><link rel="prefetch" href="/w2023/assets/js/38.388e9638.js"><link rel="prefetch" href="/w2023/assets/js/39.aa1380a5.js"><link rel="prefetch" href="/w2023/assets/js/4.c0130289.js"><link rel="prefetch" href="/w2023/assets/js/40.1e348976.js"><link rel="prefetch" href="/w2023/assets/js/6.fec5c1cc.js"><link rel="prefetch" href="/w2023/assets/js/7.054fdd44.js"><link rel="prefetch" href="/w2023/assets/js/8.5b458cb5.js"><link rel="prefetch" href="/w2023/assets/js/9.2198ac92.js">
    <link rel="stylesheet" href="/w2023/assets/css/0.styles.9d277d19.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/w2023/" class="home-link router-link-active"><!----> <span class="site-name">MAD9124</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/w2023/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2023/modules/" class="nav-link router-link-active">
  Modules
</a></div><div class="nav-item"><a href="/w2023/deliverables/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2023/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/w2023/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2023/modules/" class="nav-link router-link-active">
  Modules
</a></div><div class="nav-item"><a href="/w2023/deliverables/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2023/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Content Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/w2023/modules/" aria-current="page" class="sidebar-link">Table of contents</a></li><li><a href="/w2023/modules/week1/" class="sidebar-link">Week 1: Introduction &amp; Review</a></li><li><a href="/w2023/modules/week2/" class="sidebar-link">Week 2: Node Modules &amp; Express</a></li><li><a href="/w2023/modules/week3/" class="sidebar-link">Week 3: APIs</a></li><li><a href="/w2023/modules/week4/" class="sidebar-link">Week 4: Building RESTful APIs with Express</a></li><li><a href="/w2023/modules/week5/" class="sidebar-link">Week 5: Asynchronous Programming</a></li><li><a href="/w2023/modules/week6/" class="sidebar-link">Week 6: Middleware</a></li><li><a href="/w2023/modules/week7/" class="sidebar-link">Week 7: Midterm Project</a></li><li><a href="/w2023/modules/break-week/" class="sidebar-link">Break Week</a></li><li><a href="/w2023/modules/week9/" class="sidebar-link">Week 9: Data Persitance and MongoDB</a></li><li><a href="/w2023/modules/week10/" aria-current="page" class="active sidebar-link">Week 10: Object Data Modelling with Mongoose</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/week10/#agenda" class="sidebar-link">Agenda</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week10/#object-data-modelling-with-mongoose" class="sidebar-link">Object Data Modelling with Mongoose</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/week10/#schema" class="sidebar-link">Schema</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week10/#schema-types" class="sidebar-link">Schema Types</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week10/#making-models" class="sidebar-link">Making Models</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week10/#relationships" class="sidebar-link">Relationships</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week10/#mongo-query-operators" class="sidebar-link">Mongo Query Operators</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week10/#mongoose-query-helpers" class="sidebar-link">Mongoose Query Helpers</a></li></ul></li><li class="sidebar-sub-header"><a href="/w2023/modules/week10/#mongodb-vs-mongodb-atlas-what-are-the-differences" class="sidebar-link">MongoDB vs MongoDB Atlas: What are the differences?</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week10/#create-a-mongodb-atlas-account" class="sidebar-link">Create a MongoDB Atlas Account</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week10/#connect-to-mongodb-atlas-from-node-js" class="sidebar-link">Connect to MongoDB Atlas from Node.js</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week10/#assignment-mongodb-crud-on-the-cloud-using-pokemon-data" class="sidebar-link">Assignment - MongoDB CRUD on the cloud using Pokemon data</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/week10/#note-validation-can-now-be-taken-care-of-by-mongoose" class="sidebar-link">NOTE - Validation can now be taken care of by mongoose</a></li></ul></li></ul></li><li><a href="/w2023/modules/week11/" class="sidebar-link">Week 11: Authentication With Passport</a></li><li><a href="/w2023/modules/week12/" class="sidebar-link">Week 12: Data Santization, XSS and LoggingS</a></li><li><a href="/w2023/modules/week13/" class="sidebar-link">Week 13: Testing with Jest</a></li><li><a href="/w2023/modules/week14/" class="sidebar-link">Week 14: Preparing for Production</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1><span class="week">Week 10</span><br> <span class="title">Object Data Modelling with Mongoose</span></h1> <h2 id="agenda"><a href="#agenda" class="header-anchor">#</a> Agenda</h2> <ul><li>AMA (15 min)</li> <li>Mongoose Models (20 mins)</li> <li>Mongoose Query Methods (10 mins)</li> <li>MongoDB on Atlas</li> <li>Assignment MongoDB CRUN on Cloud</li></ul> <h2 id="object-data-modelling-with-mongoose"><a href="#object-data-modelling-with-mongoose" class="header-anchor">#</a> Object Data Modelling with Mongoose</h2> <h1 id="mongoose-models"><a href="#mongoose-models" class="header-anchor">#</a> Mongoose Models</h1> <hr> <p>Mongoose is a Node.js based Object Data Modelling (ODM) library for MongoDB. It is used to abstract away the lower level MongoDB access APIs and manage the shape of application resource data structures. This is the <strong>M</strong> in the MVC software architecture pattern.</p> <p>Mongoose provides two core features to simplify the implementation of a MongoDB backed application.</p> <ol><li><p>The <code>mongoose.model()</code> method is a class factory -- meaning it is a function that returns a new class object which we can then use to instantiate individual document objects. This factory function takes two arguments: the name of the resource that this model represents, and a schema object describing the properties of that resource.</p></li> <li><p>The <code>mongoose.Schema</code> class is used to define the expected shape of resource properties -- their names, types, and validation limits.</p></li></ol> <h3 id="schema"><a href="#schema" class="header-anchor">#</a> Schema</h3> <p>A model schema could be a simple object specifying the property names and types.</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> catSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token literal-property property">age</span><span class="token operator">:</span> Number
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Or it can be expressed with more detailed options.</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> catSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">minlength</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">maxlength</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> Number<span class="token punctuation">,</span> <span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">max</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="schema-types"><a href="#schema-types" class="header-anchor">#</a> Schema Types</h3> <p>The following <a href="https://mongoosejs.com/docs/schematypes.html" target="_blank" rel="noopener noreferrer">Mongoose Schema Types (opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> are permitted:</p> <ul><li>Array</li> <li>Boolean</li> <li>Buffer</li> <li>Date</li> <li>Mixed (A generic / flexible data type)</li> <li>Number</li> <li>ObjectId</li> <li>String</li></ul> <p><strong>Mixed</strong> and <strong>ObjectId</strong> are defined under <code>mongoose.Schema.Types</code>. We will look at this a little later when we create an owner relationship for the cars API.</p> <h3 id="making-models"><a href="#making-models" class="header-anchor">#</a> Making Models</h3> <p>Start by using the schema object with the <code>model()</code> factory method to generate a new class.</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> Cat <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> catSchema<span class="token punctuation">)</span>
</code></pre></div><p>... and then we can use that Cat model to instantiate a new Mongoose document instance.</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> kitty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Spot'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>The <code>mongoose.model</code> factory function generates new class objects, customized with the given schema, that inherit all of the methods required to interact with the MongoDB service. This includes a list of <a href="https://mongoosejs.com/docs/queries.html" target="_blank" rel="noopener noreferrer">static class methods (opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> as well as <a href="https://mongoosejs.com/docs/guide.html#methods" target="_blank" rel="noopener noreferrer">instance methods (opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. e.g.</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// example class method</span>
    Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment">// example instance method</span>
    kitty<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
</code></pre></div><h3 id="relationships"><a href="#relationships" class="header-anchor">#</a> Relationships</h3> <p>Most applications have more complex data structures than our simple Cat model. Often this involves a relationship to another model. For example we might want to extend the Cat model to include an owner. In traditional SQL database systems, this means creating a new table to store the details about the Person that is the owner of the Cat, and then adding a new property like <code>owner_id</code> to the Cat schema to store the foreign key pointer to <code>people.id</code>.</p> <p>Document databases like <a href="https://docs.mongodb.com/manual/applications/data-models-relationships/" target="_blank" rel="noopener noreferrer">MongoDB give us two options (opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>: embedded documents, and document references.</p> <h4 id="document-references"><a href="#document-references" class="header-anchor">#</a> Document References</h4> <p>Document references are similar to an SQL foreign key. It stores the <code>_id</code> value of a document in another collection. Unlike SQL databases this relationship is not enforced at the database level -- there is no validation that the reference id exists. We would add it to the schema like this, where the <code>ref</code> option is the name of another model class in our application.</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> catSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">minlength</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">maxlength</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> Number<span class="token punctuation">,</span> <span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">max</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">owner</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token string">'Person'</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Another difference from SQL is that the reference property could be an array.</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> catSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">minlength</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">maxlength</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> Number<span class="token punctuation">,</span> <span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">max</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">owners</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span> <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token string">'Person'</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
</code></pre></div><h5 id="example-usage"><a href="#example-usage" class="header-anchor">#</a> Example usage</h5> <p>The <code>owners</code> property stores an array of one or more <a href="https://mongoosejs.com/docs/schematypes.html#objectids" target="_blank" rel="noopener noreferrer">ObjectId (opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> references to the unique <code>_id</code> of a document in the <code>Person</code> collection.</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> Cat <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> catSchema<span class="token punctuation">)</span>
    
    <span class="token keyword">const</span> kitty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Fluffy'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token literal-property property">owners</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'6021b7be9d383359e30a1327'</span><span class="token punctuation">,</span> <span class="token string">'6021b94e6a3a0b5a03fcd7ba'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
</code></pre></div><h4 id="embedded-documents"><a href="#embedded-documents" class="header-anchor">#</a> Embedded Documents</h4> <p>The other option is to embed the related documents as properties of the main document.</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> personSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">firstName</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token literal-property property">lastName</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token literal-property property">phoneNumber</span><span class="token operator">:</span> Number
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token keyword">const</span> catSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">minlength</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">maxlength</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> Number<span class="token punctuation">,</span> <span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">max</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">owners</span><span class="token operator">:</span> <span class="token punctuation">[</span>personSchema<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token keyword">const</span> Cat <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> catSchema<span class="token punctuation">)</span>
    
    <span class="token keyword">const</span> kitty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Fluffy'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token literal-property property">owners</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token literal-property property">firstName</span><span class="token operator">:</span> <span class="token string">'Mickey'</span><span class="token punctuation">,</span> <span class="token literal-property property">lastName</span><span class="token operator">:</span> <span class="token string">'Mouse'</span><span class="token punctuation">,</span> <span class="token literal-property property">phoneNumber</span><span class="token operator">:</span> <span class="token number">14155551212</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token literal-property property">firstName</span><span class="token operator">:</span> <span class="token string">'Minnie'</span><span class="token punctuation">,</span> <span class="token literal-property property">lastName</span><span class="token operator">:</span> <span class="token string">'Mouse'</span><span class="token punctuation">,</span> <span class="token literal-property property">phoneNumber</span><span class="token operator">:</span> <span class="token number">14155551212</span><span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
</code></pre></div><p>Trade-offs</p> <p>The relationship modelling method you choose is ultimately a trade-off between read query speed and data consistency.</p> <p>The referenced document method ensures that data remains consistent because it is stored in only one place for each schema model, but it requires an additional database query for each related document when retrieving the primary document. For queries returning a single document (most CRUD operations) this may be fine. However for complex search queries returning thousands of results, there could be a significant performance hit.</p> <p>The embedded document method avoids these additional database queries when retrieving data, but exponentially increases the complexity of maintaining data consistency because you are potentially storing the same data in many places and need to update them all manually.</p> <p>If we look at the Cat example above, and consider what happens when we want to change Mickey Mouse's phone number. In the reference method, we simply find the Person document for Mickey Mouse and update the phoneNumber property. Then whenever we need to contact Fluffy's owner, the data will be correct.</p> <p>However if we use the embedded method, we have to lookup all of the Cats that have an owner with the name Mickey Mouse and then update the embedded phone number. But what if there is more than one Person named Mickey Mouse? How do we know if we are updating the correct information? It can get messy if you don't plan it out well.</p> <h1 id="mongoose-query-methods"><a href="#mongoose-query-methods" class="header-anchor">#</a> Mongoose Query Methods</h1> <hr> <blockquote><p>Mongoose models provide several static helper functions for <strong>CRUD operations</strong>. Each of these functions returns a <a href="http://mongoosejs.com/docs/api.html#Query" target="_blank" rel="noopener noreferrer">mongoose Query object (opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ... A query also has a <code>.then()</code> function, and thus can be used as a promise.</p></blockquote> <p>Review the <a href="https://mongoosejs.com/docs/queries.html" target="_blank" rel="noopener noreferrer">mongoose documentation (opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for the full list, but these are the most common ones that we will be using.</p> <p><a href="https://mongoosejs.com/docs/api.html#model_Model.find" target="_blank" rel="noopener noreferrer">Model.find() (opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is used to get an array of documents matching the given filter criteria.</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> catsNamedSpot <span class="token operator">=</span> Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Spot'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>These methods act on a single document matching the given id parameter.</p> <ul><li>Model.findById()</li> <li>Model.findByIdAndRemove()</li> <li>Model.findByIdAndUpdate()</li></ul> <p>These methods act on the first document found matching the given filter criteria.</p> <ul><li>Model.findOne()</li> <li>Model.findOneAndRemove()</li> <li>Model.findOneAndUpdate()</li></ul> <h3 id="mongo-query-operators"><a href="#mongo-query-operators" class="header-anchor">#</a> Mongo Query Operators</h3> <p>In the filter criteria objects we can use any of the standard <a href="https://docs.mongodb.com/manual/reference/operator/query/" target="_blank" rel="noopener noreferrer">MongoDB query operators (opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The syntax is to provide an object as the filter condition value for the given property. That object will have one of the Mongo query operators as it's key and the corresponding relative value. Let's look at some examples.</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> catsAgedFourOrMore <span class="token operator">=</span> Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">$gte</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> catsAgedLessThanFour <span class="token operator">=</span> Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">$lt</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> catsAgedTwoFourOrSix <span class="token operator">=</span> Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">{</span>$<span class="token keyword">in</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> catsNotAgedTwoFourOrSix <span class="token operator">=</span> Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">$nin</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="mongoose-query-helpers"><a href="#mongoose-query-helpers" class="header-anchor">#</a> Mongoose Query Helpers</h3> <p>Mongoose provides some <a href="https://mongoosejs.com/docs/api.html#Query" target="_blank" rel="noopener noreferrer">helper functions (opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to make writing your queries more fluent. The syntax is sometimes more readable, but the end result is exactly the same. So, use whichever method is easier for you.</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> catsAgedFourOrMore <span class="token operator">=</span> Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> catsAgedLessThanFour <span class="token operator">=</span> Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">lt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> catsAgedTwoFourOrSix <span class="token operator">=</span> Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> catsNotAgedTwoFourOrSix <span class="token operator">=</span> Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">nin</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="mongodb-vs-mongodb-atlas-what-are-the-differences"><a href="#mongodb-vs-mongodb-atlas-what-are-the-differences" class="header-anchor">#</a> MongoDB vs MongoDB Atlas: What are the differences?</h2> <p>MongoDB and MongoDB Atlas are related, but they are not the same thing. Here are some of the key differences between MongoDB and MongoDB Atlas:</p> <ul><li><p>Deployment: MongoDB is a self-hosted database that can be installed on-premises or in the cloud, while MongoDB Atlas is a fully managed cloud-based database service provided by MongoDB Inc.</p></li> <li><p>Management: With MongoDB, you are responsible for managing and maintaining your database infrastructure, including hardware provisioning, software updates, security, and backups. With MongoDB Atlas, these tasks are handled by MongoDB Inc., allowing you to focus on building and managing your applications.</p></li> <li><p>Scalability: MongoDB can be scaled horizontally by adding more servers to the cluster, but this requires manual configuration and management. With MongoDB Atlas, scaling is automatic and can be done with a few clicks.</p></li> <li><p>Availability: MongoDB can be configured for high availability using replica sets, but this also requires manual configuration and management. With MongoDB Atlas, high availability is built-in and automatically managed by MongoDB Inc.</p></li> <li><p>Security: Both MongoDB and MongoDB Atlas provide robust security features, including authentication, encryption, and access controls. However, with MongoDB Atlas, MongoDB Inc. takes care of security updates and patches, ensuring that your database is always secure.</p></li></ul> <p>In summary, MongoDB is a self-hosted database that requires manual management and configuration, while MongoDB Atlas is a fully managed cloud-based database service that takes care of the management and maintenance of your database infrastructure.</p> <h2 id="create-a-mongodb-atlas-account"><a href="#create-a-mongodb-atlas-account" class="header-anchor">#</a> Create a MongoDB Atlas Account</h2> <p>MongoDB Atlas is a MongoDB Database-as-a-Service platform, which means that they configure and host the database for you. Then, your only responsibility will be to populate your database with what matters: data.</p> <h4 id="step-one-create-an-account"><a href="#step-one-create-an-account" class="header-anchor">#</a> Step one: Create an Account</h4> <p><strong>Use your @algonquinlive.com email address for consistency.</strong></p> <ul><li><a href="https://account.mongodb.com/account/register" target="_blank" rel="noopener noreferrer">Go here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to sign up for a new MongoDB Atlas account.</li> <li>Fill in the registration form with your information and click <strong>Sign up</strong>.
<img src="/w2023/assets/img/MongoAtlas_Signup_Page.41851e07.png" alt="Sign Up"></li></ul> <h4 id="step-two-create-an-organisation"><a href="#step-two-create-an-organisation" class="header-anchor">#</a> Step two: Create an Organisation</h4> <ul><li>Name your organisation as per your student id like the image below
<img src="/w2023/assets/img/createorganisation.7ace11c7.png" alt="Create org"></li> <li>Click <strong>Next</strong></li></ul> <h4 id="step-three-create-a-project-and-database"><a href="#step-three-create-a-project-and-database" class="header-anchor">#</a> Step three: Create a Project and Database</h4> <ul><li>Before we begin to store our data in MongoDB Atlas, let's create a project by click <code>New Project</code> on the top right corner.
<img src="/w2023/assets/img/create_project.38b7146b.png" alt="Create project"></li> <li>After creating a project it's time to create a database. Click on green button <code>Build a database</code>.</li> <li>Select <code>M0</code> free version, Provider <code>AWS</code>, Region <code>N. Virginia (us-east-1)</code>, Name <code>NebulaDB</code> <img src="/w2023/assets/img/deploy_your_database.9d0be5b6.png" alt="Create database"></li> <li>You should now see the message &quot;M0 Cluster Provisioning... This process will take 3-5 minutes.&quot; Wait until the cluster is created before going to the next step.</li> <li>In the meantime, let's create a user for our database thus we can authenticate to avoid any security issues.
::: Password Hint
Keep your password simple, for example, <code>FirstName!</code> reason for this is because it might cause an issue while trying to authenticate via MongoDB Compass if you have any special characters.
:::
<img src="/w2023/assets/img/create_user.5bb182b7.png" alt="Create user"></li> <li>Once we have the user created it's time to allow our local IP address and all network to have access to our database thus we can interact. We will add your local IP address and all network for the professors to test your application.
<img src="/w2023/assets/img/connecting_from.5d130b26.png" alt="Connecting From"></li></ul> <h4 id="connect-to-your-cluster"><a href="#connect-to-your-cluster" class="header-anchor">#</a> Connect to Your Cluster</h4> <ul><li>It's time connect your MongoDB Atlas database to local MongoDB Compass. From <code>Database Deployments</code> page select <code>connect</code>. There are several different ways to connect to database; however, we will be selecting <code>Connect using MongoDB Compass</code>. Copy the connection string.
<img src="/w2023/assets/img/connect_your_cluster.f3a11aeb.png" alt="connect your cluster"></li> <li>Head over to your MongoDB Compass paste your copied connection string in URI textfeild and replace it with your user password. Click <code>connect</code> <img src="/w2023/assets/img/compass_1.8e4fc889.png" alt="compass_1"></li> <li>Once you have connected succesfully to the database on the cloud using MongoDB Compass. It's time to add data.</li> <li>Let's start by creating a database and collection. Name your database and collection like below:
<img src="/w2023/assets/img/collection_compass.96f964c8.png" alt="Compass 2"></li> <li>Head over to your browser and check on MongoDB Atlas if the database and collection was created successfully.
<img src="/w2023/assets/img/compass_3.5214069a.png" alt="Compass 3"></li></ul> <h4 id="import-data"><a href="#import-data" class="header-anchor">#</a> Import Data</h4> <p>Just for testing purpose before we write the code, let's just import data using Compass <code>Add Data</code> feature. Download the <a href="./students.json">students.json file</a>.</p> <p><img src="/w2023/assets/img/add_data.cca13e7c.png" alt="Add Data"> <img src="/w2023/assets/img/add_data_1.1725a94f.png" alt="Add Data"> <img src="/w2023/assets/img/add_data_2.3fd297f0.png" alt="Add Data">
Go to MongoDB Atlas browser and refresh your database. You should see your data imported and on cloud ready to use.
<img src="/w2023/assets/img/add_data_3.58e72d21.png" alt="Add Data"></p> <h2 id="connect-to-mongodb-atlas-from-node-js"><a href="#connect-to-mongodb-atlas-from-node-js" class="header-anchor">#</a> Connect to MongoDB Atlas from Node.js</h2> <p>From pervious class we learned about Moogoose. Let's use Moogoose to connect to MongoDB Atlas using NodeJS.</p> <p>Create and navigate to a new folder by running the following commands on a terminal.</p> <p><code>$ mkdir mongoAtlas</code></p> <p><code>$ cd mongoAtlas</code></p> <p>Then install Express and Mongoose by executing the following command on a terminal.</p> <p><code>$ yarn add express mongoose</code></p> <h4 id="creating-the-connection"><a href="#creating-the-connection" class="header-anchor">#</a> Creating the connection</h4> <p>Create a new file <code>server.js</code> to start our Express.js server. Load mongoose and express by adding the following code to <code>server.js</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mongoose&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./routes&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> username <span class="token operator">=</span> <span class="token string">&quot;&lt;mongodb username&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> password <span class="token operator">=</span> <span class="token string">&quot;&lt;password&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cluster <span class="token operator">=</span> <span class="token string">&quot;&lt;cluster name&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> dbname <span class="token operator">=</span> <span class="token string">&quot;mad9124&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Router<span class="token punctuation">)</span><span class="token punctuation">;</span>

mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">mongodb+srv://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>username<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>password<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cluster<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.mongodb.net/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dbname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?retryWrites=true&amp;w=majority</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> 
    <span class="token punctuation">{</span>
      <span class="token literal-property property">useNewUrlParser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">useUnifiedTopology</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

db<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>console<span class="token punctuation">,</span> <span class="token string">&quot;connection error: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connected successfully&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Server is running at port 3000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><em><strong>It’s important to note that the cluster variable is the values appearing between the @ and .mongodb.net. In my case the cluster variable is nebuladb.slv3id8.</strong></em></p> <h2 id="assignment-mongodb-crud-on-the-cloud-using-pokemon-data"><a href="#assignment-mongodb-crud-on-the-cloud-using-pokemon-data" class="header-anchor">#</a> Assignment - MongoDB CRUD on the cloud using Pokemon data</h2> <ul><li>Copy your Pokemon midterm into a new project in your mad9124 repo under <code>week10</code>.</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>  <span class="token function">cp</span> <span class="token parameter variable">-a</span> path/to/midterm/ week10/exercise
</code></pre></div><ul><li>Create <code>src/utils/db.js</code> file to connect your db.</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token string">'use strict'</span>

  <span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// add connection logic here</span>
</code></pre></div><p><em>Don't forget to import this file into index.js!!!</em></p> <ul><li>Migrate all of your service methods to use <code>mongoose</code> instead of an in memory <code>pokemon</code> array. <em>NOTE you only need to upgrade your pokemon resource, trainers will not be evaluated for this assignment</em></li></ul> <h3 id="note-validation-can-now-be-taken-care-of-by-mongoose"><a href="#note-validation-can-now-be-taken-care-of-by-mongoose" class="header-anchor">#</a> NOTE - Validation can now be taken care of by mongoose</h3> <ul><li>Make sure to use async / await correctly</li> <li>Make sure to import and export correctly to and from each module</li> <li>Start the Express server and test the user creation route using a Postman.</li> <li>Once you are confident it is running as expected, commit your changes, push to github, and submit with a link to your github repo in Brightspace!</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/16/2023, 5:48:31 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/w2023/modules/week9/" class="prev">
        Week 9: Data Persitance and MongoDB
      </a></span> <span class="next"><a href="/w2023/modules/week11/">
        Week 11: Authentication With Passport
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/w2023/assets/js/app.a268f35f.js" defer></script><script src="/w2023/assets/js/3.30d56026.js" defer></script><script src="/w2023/assets/js/5.9d721531.js" defer></script><script src="/w2023/assets/js/16.1e8637e4.js" defer></script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Week 9: Data Persitance and MongoDB | MAD9124</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Full-stack: API Development">
    
    <link rel="preload" href="/w2023/assets/css/0.styles.9d277d19.css" as="style"><link rel="preload" href="/w2023/assets/js/app.a268f35f.js" as="script"><link rel="preload" href="/w2023/assets/js/3.30d56026.js" as="script"><link rel="preload" href="/w2023/assets/js/13.5e27a08c.js" as="script"><link rel="preload" href="/w2023/assets/js/16.1e8637e4.js" as="script"><link rel="prefetch" href="/w2023/assets/js/10.b7c1a16d.js"><link rel="prefetch" href="/w2023/assets/js/11.f2aecf7a.js"><link rel="prefetch" href="/w2023/assets/js/12.7642e84c.js"><link rel="prefetch" href="/w2023/assets/js/14.4b92b91c.js"><link rel="prefetch" href="/w2023/assets/js/15.628eb87b.js"><link rel="prefetch" href="/w2023/assets/js/17.feedfd9c.js"><link rel="prefetch" href="/w2023/assets/js/18.4d23c18f.js"><link rel="prefetch" href="/w2023/assets/js/19.bdc3f6f0.js"><link rel="prefetch" href="/w2023/assets/js/2.c49fd8f9.js"><link rel="prefetch" href="/w2023/assets/js/20.7bb0ba89.js"><link rel="prefetch" href="/w2023/assets/js/21.bbf158ab.js"><link rel="prefetch" href="/w2023/assets/js/22.04ba04d6.js"><link rel="prefetch" href="/w2023/assets/js/23.b3f8222f.js"><link rel="prefetch" href="/w2023/assets/js/24.74d3f93b.js"><link rel="prefetch" href="/w2023/assets/js/25.5343cc2e.js"><link rel="prefetch" href="/w2023/assets/js/26.9f73a8bf.js"><link rel="prefetch" href="/w2023/assets/js/27.45bceba5.js"><link rel="prefetch" href="/w2023/assets/js/28.3f49100e.js"><link rel="prefetch" href="/w2023/assets/js/29.dff6b604.js"><link rel="prefetch" href="/w2023/assets/js/30.0d01a8e4.js"><link rel="prefetch" href="/w2023/assets/js/31.cfbc8e9f.js"><link rel="prefetch" href="/w2023/assets/js/32.2bd8381f.js"><link rel="prefetch" href="/w2023/assets/js/33.c0fa7e80.js"><link rel="prefetch" href="/w2023/assets/js/34.a29cefed.js"><link rel="prefetch" href="/w2023/assets/js/35.26354f67.js"><link rel="prefetch" href="/w2023/assets/js/36.5d697666.js"><link rel="prefetch" href="/w2023/assets/js/37.19db9f95.js"><link rel="prefetch" href="/w2023/assets/js/38.388e9638.js"><link rel="prefetch" href="/w2023/assets/js/39.aa1380a5.js"><link rel="prefetch" href="/w2023/assets/js/4.c0130289.js"><link rel="prefetch" href="/w2023/assets/js/40.1e348976.js"><link rel="prefetch" href="/w2023/assets/js/5.9d721531.js"><link rel="prefetch" href="/w2023/assets/js/6.fec5c1cc.js"><link rel="prefetch" href="/w2023/assets/js/7.054fdd44.js"><link rel="prefetch" href="/w2023/assets/js/8.5b458cb5.js"><link rel="prefetch" href="/w2023/assets/js/9.2198ac92.js">
    <link rel="stylesheet" href="/w2023/assets/css/0.styles.9d277d19.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/w2023/" class="home-link router-link-active"><!----> <span class="site-name">MAD9124</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/w2023/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2023/modules/" class="nav-link router-link-active">
  Modules
</a></div><div class="nav-item"><a href="/w2023/deliverables/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2023/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/w2023/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/w2023/modules/" class="nav-link router-link-active">
  Modules
</a></div><div class="nav-item"><a href="/w2023/deliverables/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/w2023/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Content Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/w2023/modules/" aria-current="page" class="sidebar-link">Table of contents</a></li><li><a href="/w2023/modules/week1/" class="sidebar-link">Week 1: Introduction &amp; Review</a></li><li><a href="/w2023/modules/week2/" class="sidebar-link">Week 2: Node Modules &amp; Express</a></li><li><a href="/w2023/modules/week3/" class="sidebar-link">Week 3: APIs</a></li><li><a href="/w2023/modules/week4/" class="sidebar-link">Week 4: Building RESTful APIs with Express</a></li><li><a href="/w2023/modules/week5/" class="sidebar-link">Week 5: Asynchronous Programming</a></li><li><a href="/w2023/modules/week6/" class="sidebar-link">Week 6: Middleware</a></li><li><a href="/w2023/modules/week7/" class="sidebar-link">Week 7: Midterm Project</a></li><li><a href="/w2023/modules/break-week/" class="sidebar-link">Break Week</a></li><li><a href="/w2023/modules/week9/" aria-current="page" class="active sidebar-link">Week 9: Data Persitance and MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/week9/#agenda" class="sidebar-link">Agenda</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week9/#data-persistence" class="sidebar-link">Data persistence</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week9/#databases" class="sidebar-link">Databases</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week9/#relational-databases" class="sidebar-link">Relational Databases</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week9/#document-databases" class="sidebar-link">Document Databases</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week9/#hands-on-with-mongodb" class="sidebar-link">Hands on with MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/w2023/modules/week9/#install-mongodb" class="sidebar-link">Install MongoDB</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week9/#install-mongodb-compass" class="sidebar-link">Install MongoDB Compass</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week9/#running-mongodb-locally" class="sidebar-link">Running MongoDB locally</a></li></ul></li><li class="sidebar-sub-header"><a href="/w2023/modules/week9/#connect-to-mongodb-from-node-js" class="sidebar-link">Connect to MongoDB from Node.js</a></li><li class="sidebar-sub-header"><a href="/w2023/modules/week9/#excerise-set-up-mongodb" class="sidebar-link">Excerise: Set-up MongoDB</a></li></ul></li><li><a href="/w2023/modules/week10/" class="sidebar-link">Week 10: Object Data Modelling with Mongoose</a></li><li><a href="/w2023/modules/week11/" class="sidebar-link">Week 11: Authentication With Passport</a></li><li><a href="/w2023/modules/week12/" class="sidebar-link">Week 12: Data Santization, XSS and LoggingS</a></li><li><a href="/w2023/modules/week13/" class="sidebar-link">Week 13: Testing with Jest</a></li><li><a href="/w2023/modules/week14/" class="sidebar-link">Week 14: Preparing for Production</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1><span class="week">Week 9</span><br> <span class="title">Data Persitance and MongoDB</span></h1> <h2 id="agenda"><a href="#agenda" class="header-anchor">#</a> Agenda</h2> <ul><li>AMA (10 mins)</li> <li>Data persistence</li> <li>Difference between NoSQL DB and MySQL DB</li> <li>MongoDB on local</li> <li>Moongoose</li></ul> <h2 id="data-persistence"><a href="#data-persistence" class="header-anchor">#</a> Data persistence</h2> <p>Data persistence refers to the method of storing data in a permanent manner, even after the end of a session or the shutdown of the system. There are several ways to achieve data persistence in Node.js, including:</p> <ul><li><p>File System: Node.js provides a built-in module 'fs' to read and write files.</p></li> <li><p>Database: Popular databases used in Node.js include MySQL, PostgreSQL, MongoDB, etc.</p></li> <li><p>Cache: In-memory caching solutions like Redis or Memcached can be used for data persistence in Node.js.</p></li> <li><p>Object Serialization: Node.js provides the 'Object.serialize()' method to convert an object into a string representation, which can then be written to disk or a database.</p></li></ul> <p>Ultimately, the choice of data persistence method depends on the requirements of your application, such as scalability, security, performance, and data structure. All these information would become valuable in final-term Applied Projects.</p> <h2 id="databases"><a href="#databases" class="header-anchor">#</a> Databases</h2> <p>Most real world applications need to store structured data that reflects the state of the application and is selectively searchable, with appropriate authorization credentials. This is the job of a database.</p> <p>Traditionally databases systems have been based on a series of tables, like a spreadsheet, with the columns representing the properties on a record and each row containing the complete set of properties for that unique record.</p> <p>The cars data we have seen might be represented in a table like this:</p> <div class="language-database extra-class"><pre class="language-text"><code>| id |  make | model | colour | 
|---:|:-----:|:-----:|:------:|
|  1 | Tesla | S     | Black  |
|  2 | Tesla | 3     | Indigo |
|  3 | Tesla | X     | Brown  |
|  4 | Tesla | Y     | Silver |
</code></pre></div><h2 id="relational-databases"><a href="#relational-databases" class="header-anchor">#</a> Relational Databases</h2> <p>Relational databases are a type of database management system (DBMS) that use a relational model to organize data into one or more tables. The relationships between the tables are defined by common fields (keys) between them, which serve as unique identifiers for each record. The most widely used relational database management systems are <code>MySQL</code>, <code>PostgreSQL</code>, <code>Microsoft SQL Server</code>, <code>Oracle Database</code>, and <code>SQLite</code>.</p> <p>In a relational database, data is organized into rows and columns within tables, with each row representing a single record and each column representing a specific piece of information about the record. The relationships between tables are defined by the presence of common columns (keys) in multiple tables, which are used to link records together.</p> <p>Relational databases are well suited for applications that require complex data relationships and transactions, as well as for managing large amounts of structured data. They offer robust querying capabilities, enabling developers to retrieve and manipulate data in a variety of ways. However, they can be slower and more difficult to scale than other types of databases, such as NoSQL databases.</p> <h2 id="document-databases"><a href="#document-databases" class="header-anchor">#</a> Document Databases</h2> <p>Document databases are a type of NoSQL database management system (DBMS) that store data in semi-structured or unstructured documents. Each document represents a single record and contains all the information about that record, including both data and metadata. The documents are stored within collections, which are similar to tables in relational databases.</p> <p>In document databases, data is stored as JSON or BSON documents, which are flexible and allow for easy scaling and high performance. The schema-less nature of document databases means that documents can have different structures and fields, making it easier to add new data to the database without having to modify the existing schema.</p> <p>Document databases are well suited for applications that require high performance and scalability, as well as for handling complex, hierarchical data structures. Popular document databases include <code>MongoDB</code>, <code>CouchDB</code>, and <code>RavenDB</code>. However, document databases can be more difficult to query and may have limitations when it comes to complex transactions and data relationships.</p> <h2 id="hands-on-with-mongodb"><a href="#hands-on-with-mongodb" class="header-anchor">#</a> Hands on with MongoDB</h2> <h3 id="install-mongodb"><a href="#install-mongodb" class="header-anchor">#</a> Install MongoDB</h3> <p>There are several ways to get MongoDB running in your local development environment.</p> <ul><li>Download the runtime installer from the MongoDB website.</li> <li>Use Homebrew to install MongoDB.</li> <li>Use Docker and run it in a container.</li></ul> <p>For this course, we will using <strong>Homebrew to install MongoDB</strong>.</p> <ul><li>Open the Terminal app and type <code>brew update</code>.</li> <li>After updating Homebrew <code>brew install mongodb</code></li> <li>After downloading Mongo, create the <code>db</code> directory. This is where the Mongo data files will live. You can create the directory in the default location by running <code>sudo mkdir -p /data/db</code></li> <li>Make sure that the <code>/data/db</code> directory has the right permissions by running</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&gt; sudo chown -R /data/db
&gt; # Enter your password
</code></pre></div><ul><li>Run the Mongo daemon, in one of your terminal windows run <code>mongod</code>. This should start the Mongo server.</li> <li>Run the Mongo shell, with the Mongo daemon running in one terminal, type <code>mongo</code> in another terminal window. This will run the Mongo shell which is an application to access data in MongoDB.</li></ul> <div class="language- extra-class"><pre class="language-text"><code>mongod //in one of your terminal
mongo //in another terminal
</code></pre></div><ul><li>To exit the Mongo shell run <code>quit()</code></li> <li>To stop the Mongo daemon hit <code>ctrl-c</code></li></ul> <p><strong>Set Mongo as a service on Mac</strong>
Most importantly to run mongo as a service first stop mongo and mongod by using <code>ctrl+c</code></p> <p>To run Mongo daemon as a service run command: brew services start mongodb
After successfully run the command, Now restart the computer to set mongo as a service</p> <p><code>brew services start mongodb</code></p> <h3 id="install-mongodb-compass"><a href="#install-mongodb-compass" class="header-anchor">#</a> Install MongoDB Compass</h3> <p>If you have worked with MySQL databases in the past you probably used a tool like phpMyAdmin, MySQL WorkBench or Sequel PRO to manage and query your databases. MongoDB has a similar tool call Compass. You can read all about its capabilities on at <a href="https://www.mongodb.com/try/download/compass#:~:text=MongoDB%20Compass%20Download" target="_blank" rel="noopener noreferrer">MongoDB.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p><strong>Make sure to select Platform depending on your MAC</strong></p> <p><img src="compass_1.png" alt="Download Compass"></p> <p>With the correct version selected, click the big green download button, and then run the DMG installer (the downloaded file).</p> <h3 id="running-mongodb-locally"><a href="#running-mongodb-locally" class="header-anchor">#</a> Running MongoDB locally</h3> <p>Open the MongoDB Compass app and connect using this connection string</p> <p><code>mongodb://localhost:27017</code></p> <p><img src="/w2023/assets/img/compass_2.0ea0b52a.png" alt="Compass starting page"></p> <p>You should now see an active connection to the database engine that looks like this:</p> <p><img src="/w2023/assets/img/compass_3.0e1cec6c.png" alt="Compass Database"></p> <h2 id="connect-to-mongodb-from-node-js"><a href="#connect-to-mongodb-from-node-js" class="header-anchor">#</a> Connect to MongoDB from Node.js</h2> <p>All that set-up was so that we can persist application state in a database.</p> <p>In your Node.js apps, you will need to open a connection to the MongoDB database so that you can store and retrieve your resource objects (JSON documents). MongoDB provides a official NPM package which we can use to interact with the database. To install it in your project, simply run <code>yarn install mongodb</code> in the terminal.</p> <p><strong>However ...</strong></p> <p>For this course we will instead be using a popular data modelling library called <a href="https://mongoosejs.com/" target="_blank" rel="noopener noreferrer">Mongoose<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="mongoose-quick-start"><a href="#mongoose-quick-start" class="header-anchor">#</a> Mongoose Quick Start</h4> <p><code>yarn add mongoose</code></p> <p>OR if you're using npm use <code>npm install mongoose</code></p> <p>Create a new file in your project folder called <code>mongooseTest.js</code>. We will give the mongoose.connect method the same connection string for our local MongoDB server that we used with Compass and then append the name of the database we want to connect to at the end. Let's call the database <code>test</code>. The full connection string should now be <code>mongodb://localhost:27017/test</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017/test'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">useNewUrlParser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">useUnifiedTopology</span><span class="token operator">:</span> <span class="token boolean">true</span>
</code></pre></div><blockquote><p>The mongoose.connect() method takes two arguments. The first is the connection string. The second is a configuration options object (opens new window). Here we have used the <code>useNewUrlParser:</code> true option and the <code>useUnifiedTopology:</code> true option. These are required for connecting to MongoDB servers of version 4.0 or higher. Also, with this option, the port number MUST be included in the connection string.</p></blockquote> <blockquote><p>Even though we have not previously created this <code>/test</code> database, MongoDB will automatically create it the first time we try to interact with it.</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Cat <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> kitty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Spot'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
kitty<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">savedKitty</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>savedKitty<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> says 'meow'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>The <code>mongoose.model</code> method is a class factory (opens new window)that creates a resource class that represents a document collection and we can use it to interact with the database. In the example above we are giving it two properties: <code>'Cat'</code> is the name of the class of objects to store in a collection in the database, and <code>{name: String}</code> is the expected shape of each <code>'Cat'</code> document - it will have a property called 'name' which will hold some string data.</p> <p><strong>An instance of a Model is a Mongoose Document.</strong>
Use the <code>new</code> keyword with the model class to create a new instance, or new database document from that class.</p> <blockquote><p>Naming conventions: Models are named as a singular noun and start with a capital letter. Database tables or document collections are named as the plural of the model name and are all lower case.</p></blockquote> <p>OK. Lets run it and then check the results in MongoDB Compass.</p> <div class="language-js extra-class"><pre class="language-js"><code>node mongooseTest<span class="token punctuation">.</span>js
</code></pre></div><p>Let's try adding another Cat instance to the collection. Change the name on line three and rerun it.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Cat <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> kitty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Patches'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
kitty<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">savedKitty</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>savedKitty<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> says 'meow'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Let's try adding an age to our next Cat.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Cat <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> kitty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Callie'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
kitty<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">savedKitty</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>savedKitty<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> says 'meow'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>This time, when we check it in Compass the age was not saved. Our Mongoose Model automatically discards any properties that are not predefined. This time change the model schema as well.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Cat <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> Number<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> kitty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Callie'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
kitty<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">savedKitty</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>savedKitty<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> says 'meow'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>We can also insert many objects into the database at once.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Cat <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> Number<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> newCats <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Fluffy'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Pink Spots'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Tabatha'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
Cat<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span>newCats<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">docs</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>We have added many documents to our collection. How do we retrieve them? Add a new line to find all of the cats from the database.</p> <div class="language-js extra-class"><pre class="language-js"><code>Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">listAll</span><span class="token operator">:</span> result<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>How about listing just the Cats with the name 'Spot'?</p> <div class="language-js extra-class"><pre class="language-js"><code>Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Spot'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">spot</span><span class="token operator">:</span> result<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>That found all of the cats with the exact name 'Spot'. But, what if we wanted to check for names like Spot? We can use regular expressions (opens new window)to match patterns. Replace the quotes with slashes. Now it will match 'Spot', 'Spots', 'Spotty', or 'Pink Spots'.</p> <div class="language-js extra-class"><pre class="language-js"><code>Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Spot</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">regex</span><span class="token operator">:</span> result<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Regular expressions can be a very powerful tool. Checkout the resources linked below to learn more.</p> <p>Putting it all together, the final version of our mongooseTest.js should look like this.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span>

<span class="token comment">// Import the Mongoose library</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>

<span class="token comment">// Connect the mongoose instance to our MongoDB</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017/test'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">useNewUrlParser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">useUnifiedTopology</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Define the document model for the 'cats' collection</span>
<span class="token keyword">const</span> Cat <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> Number<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Create a new Cat document and save it to the database</span>
<span class="token keyword">const</span> kitty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Callie'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
kitty<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">savedKitty</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>savedKitty<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> says 'meow'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// Directly insert an array of Cat property objects</span>
<span class="token keyword">const</span> newCats <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Fluffy'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Pink Spots'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Tabatha'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
Cat<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span>newCats<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">docs</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// List all of the Cats in the collection</span>
Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">listAll</span><span class="token operator">:</span> result<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// List only the Cats with 'Spot' in the name</span>
Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Spot</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">regex</span><span class="token operator">:</span> result<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>There is a lot more to learn about how to use Mongoose and we will continue next week.</p> <h2 id="excerise-set-up-mongodb"><a href="#excerise-set-up-mongodb" class="header-anchor">#</a> Excerise: Set-up MongoDB</h2> <p>Submit a screenshot of MongoDB Compass showing the connection to localhost:27017/test.cats and the listing of the documents in the collection after your test transactions.</p> <p><img src="/w2023/assets/img/compass_4.aeb65190.png" alt="MongoDB Local"></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/4/2023, 8:45:35 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/w2023/modules/break-week/" class="prev">
        Break Week
      </a></span> <span class="next"><a href="/w2023/modules/week10/">
        Week 10: Object Data Modelling with Mongoose
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/w2023/assets/js/app.a268f35f.js" defer></script><script src="/w2023/assets/js/3.30d56026.js" defer></script><script src="/w2023/assets/js/13.5e27a08c.js" defer></script><script src="/w2023/assets/js/16.1e8637e4.js" defer></script>
  </body>
</html>
